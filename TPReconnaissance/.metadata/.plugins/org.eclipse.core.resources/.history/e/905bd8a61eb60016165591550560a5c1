import java.util.Vector;

import javafx.geometry.Point2D;


public class DTW {
	Vector<Point2D> userGesture;
	
	public DTW (Vector<Point2D> userGesture){
		this.userGesture = userGesture;
	}

	public String detectGesture() {
		// TODO Auto-generated method stub
		return "bien maggle";
	}
	
	public Vector<Point2D> normalize(){
		Vector<Point2D> newGesture = new Vector<Point2D>();
		double minX, minY, maxX, maxY;
		minX = maxX = userGesture.get(0).getX();
		minY = maxY = userGesture.get(0).getY();
		
		for(int i = 1; i<userGesture.size(); i++){
			double tmpX = userGesture.get(i).getX();
			double tmpY = userGesture.get(i).getY();
			
			minX = minX<tmpX?minX:tmpX;
			minY = minY<tmpY?minY:tmpY;
			
			maxX = maxX>tmpX?maxX:tmpX;
			maxY = maxY>tmpY?maxY:tmpY;
		}
		double coteCarre;
		if(maxX - minX < maxY - minY)
			coteCarre = maxX - minX;
		else 
			coteCarre = maxY - minY;
		
		for(int i = 1; i<userGesture.size(); i++){
			double tmpX = userGesture.get(i).getX();
			double tmpY = userGesture.get(i).getY();
			
			double newX, newY;
			
			newGesture.addElement(new Point2D(newX, newY));
		}
		
		
		return newGesture;
	}
	
	
	
	public Matrix calculDtw(Vector<Point2D> gestureY){
		int n = userGesture.size();
		int m = gestureY.size();
		Matrix dtw = new Matrix(n, m);
		dtw.items[0][0] = 0;
		for(int i = 1; i<n; i++){
			dtw.items[i][0] = dtw.items[i-1][0] + dist(userGesture.get(i), gestureY.get(0));
			dtw.couple[i][0] = new Couple(i-1, 0);
		}
		
		for(int j = 1; j<m; j++){
			dtw.items[0][j] = dtw.items[0][j-1] + dist(userGesture.get(0), gestureY.get(j));
			dtw.couple[0][j] = new Couple(0, j-1);
		}
		
		for(int i = 1; i<=n; i++){
			for(int j = 1; j<=m; j++){
				double tmp ;
				int pTmpX, pTmpY;
				if(dtw.items[i][j-1] < dtw.items[i-1][j-1]){
					tmp = dtw.items[i][j-1];
					pTmpX = i;
					pTmpY = j-1;
				} else {
					tmp = dtw.items[i-1][j-1];
					pTmpX = i-1;
					pTmpY = j-1;
				}
				
				if(tmp > dtw.items[i-1][j]){
					tmp = dtw.items[i-1][j];
					pTmpX = i-1;
					pTmpY = j;
				}

				
				/*Le couple est utile pour récupérer la valeur prédentes, c'est à dire la valeur grace a laquelle nous avons obtenue le min*/
				dtw.items[i][j] =dist(userGesture.get(i), gestureY.get(j)) 
						+ tmp;
				dtw.couple[i][j] = new Couple(pTmpX, pTmpY);
			}
		}
		
		return dtw;
	}
	
	public double dist(Point2D a, Point2D b){
		return Math.sqrt(Math.pow(a.getX() - b.getX(), 2) + Math.pow(a.getY() - b.getY(), 2));
	}
	
	
}
